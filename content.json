{"pages":[{"title":"about","text":"About me Now in working in Edgecore Networks Open Networking Foundation ambassador Most time in China Interesting topics Mobile network Open networking Container CI/CD tools","link":"/about/index.html"}],"posts":[{"title":"Upgrade OpenBMC and CPLD in Wedge100BF","text":"Prepare Edgecore Wedge100BF-32X USB with at least 4Gb OpenBMC and CPLD upgrade files Please unzip all files and copy to USB root directory Note: If you need upgrade files, please contact switch vendor or following contact window Edgecore Network: jimmy_ou@edge-core.com *Warning: It will be sugget to contact switch vendor to upgrade firmware, if user upgrade fail then switch might be brick. The switch will need to RMA and the vendor might charge for this.* Stepsconnect to consoleAfter OpenBMC is ready, loginin with root/0penBmc Upgrade OpenBMCConfirm original OpenBMC version 1cat /etc/issue Check MTD configuration 1cat /proc/mtd Install new OpenBMC image(flash-mavericks) to MTD(flash0) 1flashcp -v flash-mavericks /dev/mtd5 and Reboot Upgrade CPLDConfirm original CPLD version 12i2cget -f -y 12 0x31 0x1i2cget -f -y 12 0x31 0x2 Set CPLD_UPPER_JTAG_SEL and CPLD_JTAG_SEL 123devmem 0x1e6e2080 32 0xE0CA0002echo out &gt; /tmp/gpionames/CPLD_JTAG_SEL/directionecho 1 &gt; /tmp/gpionames/CPLD_JTAG_SEL/value Install CPLD code 1jbi -r -aPROGRAM -gc102 -gi101 -go103 -gs100 &lt;file path&gt; *Do not power off DUT during installation. System shall reboot automatically after updating lower CPLD code*","link":"/2020/01/26/Upgrade-OpenBMC-and-CPLD-in-Wedge100BF/"},{"title":"Upgrade BIOS and EC in Wedge100BF","text":"Prepare Edgecore Wedge100BF USB with at least 4Gb BIOS and EC upgrade files Please unzip all files and copy to USB root directory Note: If you need upgrade files, please contact switch vendor or following contact window Edgecore Network: jimmy_ou@edge-core.com *Warning: It will be sugget to contact switch vendor to upgrade firmware, if user upgrade fail then switch might be brick. The switch will need to RMA and the vendor might charge for this.* Stepsconnect to consoleAfter OpenBMC is ready, loginin with root/0penBmc and use command sol.sh to connect host CPU Reboot host CPU and push &lt;ESC&gt; get into BIOS, change to Save&amp;Exit tab and choose UEFI: Built-in EFI Shell Upgrade BIOS123Shell&gt; fs1: &lt;Enter&gt;fs1:\\&gt;cd (BIOS path) &lt;Enter&gt;update.efi Upgrade EC123Shell&gt; fs1: &lt;Enter&gt;fs1:\\&gt;cd (EC path) &lt;Enter&gt;update.efi *Warning: You must wait 1 min before reboot*","link":"/2020/01/26/Upgrade-BIOS-and-EC-in-Wedge100BF/"},{"title":"Install Stratum on Wedge100BF","text":"Stratum: The open source project owned by Open Networking Foundation(ONF) The device we used is Edgecore Wedge100BF-32X, but all the step are also can be used in Edgecore Wedge100BF-65X Device Edgecore Wedge100BF-32 Notice: Need to check the switch firmware version, otherwise it might be stuck when loading ONL If you need upgrade firmware, please contact switch vendor or following contact window Edgecore Networks: jimmy_ou@edge-core.com OpenBMC: 1.0.0.14 CPLD: 10.1 BIOS: R1.00.E2 (8/29/2018) EC: R04.E01(10/10/2018) StepsInstall ONL which contained ONLPv21onie-nos-install https://github.com/opennetworkinglab/OpenNetworkLinux/releases/download/onlpv2-dev-1.0.1/ONL-OS_2019-09-17.0112-b2c831f_AMD64_INSTALLED_INSTALLER Install Docker1curl -sSL https://get.docker.io | bash Pull Stratum container image1docker pull stratumproject/stratum-bf:9.0.0-4.14.49-OpenNetworkLinux Create Stratum scriptCreate a shell script called “start-stratum-container.sh” and chmod +x start-stratum-container.sh The script contain following code 12345678910111213141516171819202122set -eset -xONLP_MOUNT=$(ls /lib/**/libonlp* | awk '{print \"-v \" $1 \":\" $1 \" \" }')CONFIG_DIR=${CONFIG_DIR:-/root}LOG_DIR=${LOG_DIR:-/var/log}SDE_VERSION=${SDE_VERSION:-9.0.0}KERNEL_VERSION=$(uname -r)DOCKER_IMAGE=${DOCKER_IMAGE:-stratumproject/stratum-bf}DOCKER_IMAGE_TAG=${DOCKER_IMAGE_TAG:-$SDE_VERSION-$KERNEL_VERSION}docker run -it --privileged \\ -v /dev:/dev -v /sys:/sys \\ -v /lib/modules/$(uname -r):/lib/modules/$(uname -r) \\ $ONLP_MOUNT \\ -v /lib/platform-config:/lib/platform-config \\ -v /etc/onl:/etc/onl \\ -p 28000:28000 \\ -v $CONFIG_DIR:/stratum_configs \\ -v $LOG_DIR:/stratum_logs \\ $DOCKER_IMAGE:$DOCKER_IMAGE_TAG Run StratumFinally, just execute ./start-stratum-container.sh and all is done The p4runtime server is listening in port 28000 Options default config director is under /root, it will be mount to container with path /stratum_configs If you want to change the flags used in start Stratum, you could add stratum.flags file under /root","link":"/2020/01/26/Install-Stratum-on-Wedge100BF/"}],"tags":[{"name":"Wedge100BF","slug":"Wedge100BF","link":"/tags/Wedge100BF/"},{"name":"Barefoot","slug":"Barefoot","link":"/tags/Barefoot/"},{"name":"Stratum","slug":"Stratum","link":"/tags/Stratum/"}],"categories":[{"name":"Wedge100BF","slug":"Wedge100BF","link":"/categories/Wedge100BF/"},{"name":"Stratum","slug":"Stratum","link":"/categories/Stratum/"}]}